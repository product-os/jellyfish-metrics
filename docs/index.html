<!doctype html>
<html class="default no-js">
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>@balena/jellyfish-metrics</title>
	<meta name="description" content="Documentation for @balena/jellyfish-metrics">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="assets/css/main.css">
	<script async src="assets/js/search.js" id="search-script"></script>
</head>
<body>
<header>
	<div class="tsd-page-toolbar">
		<div class="container">
			<div class="table-wrap">
				<div class="table-cell" id="tsd-search" data-index="assets/js/search.json" data-base=".">
					<div class="field">
						<label for="tsd-search-field" class="tsd-widget search no-caption">Search</label>
						<input id="tsd-search-field" type="text" />
					</div>
					<ul class="results">
						<li class="state loading">Preparing search index...</li>
						<li class="state failure">The search index is not available</li>
					</ul>
					<a href="index.html" class="title">@balena/jellyfish-metrics</a>
				</div>
				<div class="table-cell" id="tsd-widgets">
					<div id="tsd-filter">
						<a href="#" class="tsd-widget options no-caption" data-toggle="options">Options</a>
						<div class="tsd-filter-group">
							<div class="tsd-select" id="tsd-filter-visibility">
								<span class="tsd-select-label">All</span>
								<ul class="tsd-select-list">
									<li data-value="public">Public</li>
									<li data-value="protected">Public/Protected</li>
									<li data-value="private" class="selected">All</li>
								</ul>
							</div>
							<input type="checkbox" id="tsd-filter-inherited" checked />
							<label class="tsd-widget" for="tsd-filter-inherited">Inherited</label>
						</div>
					</div>
					<a href="#" class="tsd-widget menu no-caption" data-toggle="menu">Menu</a>
				</div>
			</div>
		</div>
	</div>
	<div class="tsd-page-title">
		<div class="container">
			<h1>@balena/jellyfish-metrics</h1>
		</div>
	</div>
</header>
<div class="container container-main">
	<div class="row">
		<div class="col-8 col-content">
			<div class="tsd-panel tsd-typography">
				<a href="#jellyfish-metrics" id="jellyfish-metrics" style="color: inherit; text-decoration: none;">
					<h1>Jellyfish Metrics</h1>
				</a>
				<p>This library gathers Prometheus metrics and exposes them to be scraped by <a href="https://github.com/balena-io/balena-monitor">balena-monitor</a>.
				Jellyfish production metrics can be found in <a href="https://monitor.balena-cloud.com/d/jellyfish/jellyfish?orgId=1">this dashboard</a>.</p>
				<a href="#usage" id="usage" style="color: inherit; text-decoration: none;">
					<h1>Usage</h1>
				</a>
				<p>Below is an example how to use this library:</p>
				<pre><code class="language-js"><span style="color: #0000FF">const</span><span style="color: #000000"> </span><span style="color: #0070C1">metrics</span><span style="color: #000000"> = </span><span style="color: #795E26">require</span><span style="color: #000000">(</span><span style="color: #A31515">&#039;@balena/jellyfish-metrics&#039;</span><span style="color: #000000">)</span>

<span style="color: #008000">// Start server to expose gathered metrics data.</span>
<span style="color: #001080">metrics</span><span style="color: #000000">.</span><span style="color: #795E26">startServer</span><span style="color: #000000">(</span><span style="color: #001080">context</span><span style="color: #000000">, </span><span style="color: #001080">portNumber</span><span style="color: #000000">)</span>

<span style="color: #008000">// Mark that a card was read from the database.</span>
<span style="color: #001080">metrics</span><span style="color: #000000">.</span><span style="color: #795E26">markCardReadFromDatabase</span><span style="color: #000000">(</span><span style="color: #001080">card</span><span style="color: #000000">)</span>
</code></pre>
				<a href="#documentation" id="documentation" style="color: inherit; text-decoration: none;">
					<h1>Documentation</h1>
				</a>
				<ul>
					<li><a href="https://github.com/product-os/jellyfish-metrics/blob/master/doc/adding-metrics.markdown"><strong>Adding metrics</strong></a></li>
				</ul>
				<p>A module that gathers and exposes Prometheus metrics.</p>
				<ul>
					<li><a href="#module_metrics">metrics</a><ul>
							<li><em>static</em><ul>
									<li><a href="#module_metrics.actorFromContext">.actorFromContext(context)</a> ⇒ <code>String</code></li>
									<li><a href="#module_metrics.initExpress">.initExpress()</a> ⇒ <code>Object</code></li>
									<li><a href="#module_metrics.startServer">.startServer(context, port)</a></li>
									<li><a href="#module_metrics.markCardInsert">.markCardInsert(card)</a></li>
									<li><a href="#module_metrics.markCardUpsert">.markCardUpsert(card)</a></li>
									<li><a href="#module_metrics.markCardReadFromDatabase">.markCardReadFromDatabase(card)</a></li>
									<li><a href="#module_metrics.markCardReadFromCache">.markCardReadFromCache(card)</a></li>
									<li><a href="#module_metrics.markBackSync">.markBackSync(integration)</a></li>
									<li><a href="#module_metrics.markActionRequest">.markActionRequest(action)</a></li>
									<li><a href="#module_metrics.markQueueConcurrency">.markQueueConcurrency()</a></li>
									<li><a href="#module_metrics.markJobAdd">.markJobAdd(action, id)</a></li>
									<li><a href="#module_metrics.markJobDone">.markJobDone(action, id, timestamp)</a></li>
									<li><a href="#module_metrics.measureMirror">.measureMirror(integration, fn)</a> ⇒ <code>Any</code></li>
									<li><a href="#module_metrics.measureTranslate">.measureTranslate(integration, fn)</a> ⇒ <code>Any</code></li>
									<li><a href="#module_metrics.measureHttpQuery">.measureHttpQuery(fn)</a> ⇒ <code>Any</code></li>
									<li><a href="#module_metrics.measureHttpType">.measureHttpType(fn)</a> ⇒ <code>Any</code></li>
									<li><a href="#module_metrics.measureHttpId">.measureHttpId(fn)</a> ⇒ <code>Any</code></li>
									<li><a href="#module_metrics.measureHttpSlug">.measureHttpSlug(fn)</a> ⇒ <code>Any</code></li>
									<li><a href="#module_metrics.measureHttpAction">.measureHttpAction(fn)</a> ⇒ <code>Any</code></li>
									<li><a href="#module_metrics.measureHttpWhoami">.measureHttpWhoami(fn)</a> ⇒ <code>Any</code></li>
									<li><a href="#module_metrics.markSqlGenTime">.markSqlGenTime(ms)</a></li>
									<li><a href="#module_metrics.markQueryTime">.markQueryTime(ms)</a></li>
									<li><a href="#module_metrics.markStreamOpened">.markStreamOpened(context, table)</a></li>
									<li><a href="#module_metrics.markStreamClosed">.markStreamClosed(context, table)</a></li>
									<li><a href="#module_metrics.markStreamLinkQuery">.markStreamLinkQuery(context, table, change)</a></li>
									<li><a href="#module_metrics.markStreamError">.markStreamError(context, table)</a></li>
									<li><a href="#module_metrics.measureCardPatch">.measureCardPatch(fn)</a> ⇒ <code>Any</code></li>
								</ul>
							</li>
							<li><em>inner</em><ul>
									<li><a href="#module_metrics..measureAsync">~measureAsync(name, labels, fn)</a> ⇒ <code>Any</code></li>
									<li><a href="#module_metrics..isCard">~isCard(card)</a> ⇒ <code>Boolean</code></li>
									<li><a href="#module_metrics..getAsyncMeasureFn">~getAsyncMeasureFn(prefix, labels)</a> ⇒ <code>Any</code></li>
								</ul>
							</li>
						</ul>
					</li>
				</ul>
				<p><a name="module_metrics.actorFromContext"></a></p>
				<a href="#metricsactorfromcontextcontext-⇒-string" id="metricsactorfromcontextcontext-⇒-string" style="color: inherit; text-decoration: none;">
					<h3>metrics.actorFromContext(context) ⇒ <code>String</code></h3>
				</a>
				<p><strong>Kind</strong>: static method of <a href="#module_metrics"><code>metrics</code></a><br><strong>Summary</strong>: Extract actor name from context ID<br><strong>Returns</strong>: <code>String</code> - actor name  </p>
				<table>
					<thead>
						<tr>
							<th>Param</th>
							<th>Type</th>
							<th>Description</th>
						</tr>
					</thead>
					<tbody><tr>
							<td>context</td>
							<td><code>Object</code></td>
							<td>caller context</td>
						</tr>
				</tbody></table>
				<p><strong>Example</strong>  </p>
				<pre><code class="language-js"><span style="color: #0000FF">const</span><span style="color: #000000"> </span><span style="color: #0070C1">actorName</span><span style="color: #000000"> = </span><span style="color: #267F99">exports</span><span style="color: #000000">.</span><span style="color: #795E26">actorFromContext</span><span style="color: #000000">(</span><span style="color: #001080">context</span><span style="color: #000000">)</span>
</code></pre>
				<p><a name="module_metrics.initExpress"></a></p>
				<a href="#metricsinitexpress-⇒-object" id="metricsinitexpress-⇒-object" style="color: inherit; text-decoration: none;">
					<h3>metrics.initExpress() ⇒ <code>Object</code></h3>
				</a>
				<p><strong>Kind</strong>: static method of <a href="#module_metrics"><code>metrics</code></a><br><strong>Summary</strong>: Create express app using metrics and expose data on /metrics<br><strong>Returns</strong>: <code>Object</code> - express app<br><strong>Example</strong>  </p>
				<pre><code class="language-js"><span style="color: #0000FF">const</span><span style="color: #000000"> </span><span style="color: #0070C1">application</span><span style="color: #000000"> = </span><span style="color: #001080">metrics</span><span style="color: #000000">.</span><span style="color: #795E26">initExpress</span><span style="color: #000000">(</span><span style="color: #001080">context</span><span style="color: #000000">)</span>
</code></pre>
				<p><a name="module_metrics.startServer"></a></p>
				<a href="#metricsstartservercontext-port" id="metricsstartservercontext-port" style="color: inherit; text-decoration: none;">
					<h3>metrics.startServer(context, port)</h3>
				</a>
				<p>Expose gathered metrics on /metrics
				Reassign port to random port number on collision</p>
				<p><strong>Kind</strong>: static method of <a href="#module_metrics"><code>metrics</code></a>  </p>
				<table>
					<thead>
						<tr>
							<th>Param</th>
							<th>Type</th>
							<th>Description</th>
						</tr>
					</thead>
					<tbody><tr>
							<td>context</td>
							<td><code>Object</code></td>
							<td>execution context</td>
						</tr>
						<tr>
							<td>port</td>
							<td><code>Number</code></td>
							<td>port to expose metrics on</td>
						</tr>
				</tbody></table>
				<p><strong>Example</strong>  </p>
				<pre><code class="language-js"><span style="color: #001080">metrics</span><span style="color: #000000">.</span><span style="color: #795E26">startServer</span><span style="color: #000000">(</span><span style="color: #001080">context</span><span style="color: #000000">, </span><span style="color: #098658">9000</span><span style="color: #000000">)</span>
</code></pre>
				<p><a name="module_metrics.markCardInsert"></a></p>
				<a href="#metricsmarkcardinsertcard" id="metricsmarkcardinsertcard" style="color: inherit; text-decoration: none;">
					<h3>metrics.markCardInsert(card)</h3>
				</a>
				<p><strong>Kind</strong>: static method of <a href="#module_metrics"><code>metrics</code></a><br><strong>Summary</strong>: Mark that a card was inserted  </p>
				<table>
					<thead>
						<tr>
							<th>Param</th>
							<th>Type</th>
							<th>Description</th>
						</tr>
					</thead>
					<tbody><tr>
							<td>card</td>
							<td><code>Object</code></td>
							<td>card that was inserted</td>
						</tr>
				</tbody></table>
				<p><strong>Example</strong>  </p>
				<pre><code class="language-js"><span style="color: #001080">metrics</span><span style="color: #000000">.</span><span style="color: #795E26">markCardInsert</span><span style="color: #000000">(</span><span style="color: #001080">card</span><span style="color: #000000">)</span>
</code></pre>
				<p><a name="module_metrics.markCardUpsert"></a></p>
				<a href="#metricsmarkcardupsertcard" id="metricsmarkcardupsertcard" style="color: inherit; text-decoration: none;">
					<h3>metrics.markCardUpsert(card)</h3>
				</a>
				<p><strong>Kind</strong>: static method of <a href="#module_metrics"><code>metrics</code></a><br><strong>Summary</strong>: Mark that a card was upserted  </p>
				<table>
					<thead>
						<tr>
							<th>Param</th>
							<th>Type</th>
							<th>Description</th>
						</tr>
					</thead>
					<tbody><tr>
							<td>card</td>
							<td><code>Object</code></td>
							<td>card that was upserted</td>
						</tr>
				</tbody></table>
				<p><strong>Example</strong>  </p>
				<pre><code class="language-js"><span style="color: #001080">metrics</span><span style="color: #000000">.</span><span style="color: #795E26">markCardUpsert</span><span style="color: #000000">(</span><span style="color: #001080">card</span><span style="color: #000000">)</span>
</code></pre>
				<p><a name="module_metrics.markCardReadFromDatabase"></a></p>
				<a href="#metricsmarkcardreadfromdatabasecard" id="metricsmarkcardreadfromdatabasecard" style="color: inherit; text-decoration: none;">
					<h3>metrics.markCardReadFromDatabase(card)</h3>
				</a>
				<p><strong>Kind</strong>: static method of <a href="#module_metrics"><code>metrics</code></a><br><strong>Summary</strong>: Mark that a card was read from the database  </p>
				<table>
					<thead>
						<tr>
							<th>Param</th>
							<th>Type</th>
							<th>Description</th>
						</tr>
					</thead>
					<tbody><tr>
							<td>card</td>
							<td><code>Object</code></td>
							<td>card that was read the database</td>
						</tr>
				</tbody></table>
				<p><strong>Example</strong>  </p>
				<pre><code class="language-js"><span style="color: #001080">metrics</span><span style="color: #000000">.</span><span style="color: #795E26">markCardReadFromDatabase</span><span style="color: #000000">(</span><span style="color: #001080">card</span><span style="color: #000000">)</span>
</code></pre>
				<p><a name="module_metrics.markCardReadFromCache"></a></p>
				<a href="#metricsmarkcardreadfromcachecard" id="metricsmarkcardreadfromcachecard" style="color: inherit; text-decoration: none;">
					<h3>metrics.markCardReadFromCache(card)</h3>
				</a>
				<p><strong>Kind</strong>: static method of <a href="#module_metrics"><code>metrics</code></a><br><strong>Summary</strong>: Mark that a card was read from cache  </p>
				<table>
					<thead>
						<tr>
							<th>Param</th>
							<th>Type</th>
							<th>Description</th>
						</tr>
					</thead>
					<tbody><tr>
							<td>card</td>
							<td><code>Object</code></td>
							<td>card that was read from cache</td>
						</tr>
				</tbody></table>
				<p><strong>Example</strong>  </p>
				<pre><code class="language-js"><span style="color: #001080">metrics</span><span style="color: #000000">.</span><span style="color: #795E26">markCardReadFromCache</span><span style="color: #000000">(</span><span style="color: #001080">card</span><span style="color: #000000">)</span>
</code></pre>
				<p><a name="module_metrics.markBackSync"></a></p>
				<a href="#metricsmarkbacksyncintegration" id="metricsmarkbacksyncintegration" style="color: inherit; text-decoration: none;">
					<h3>metrics.markBackSync(integration)</h3>
				</a>
				<p><strong>Kind</strong>: static method of <a href="#module_metrics"><code>metrics</code></a><br><strong>Summary</strong>: Mark that a card has been created due to back-sync  </p>
				<table>
					<thead>
						<tr>
							<th>Param</th>
							<th>Type</th>
							<th>Description</th>
						</tr>
					</thead>
					<tbody><tr>
							<td>integration</td>
							<td><code>String</code></td>
							<td>name of integration</td>
						</tr>
				</tbody></table>
				<p><strong>Example</strong>  </p>
				<pre><code class="language-js"><span style="color: #001080">metrics</span><span style="color: #000000">.</span><span style="color: #795E26">markBackSync</span><span style="color: #000000">(</span><span style="color: #A31515">&#039;front&#039;</span><span style="color: #000000">)</span>
</code></pre>
				<p><a name="module_metrics.markActionRequest"></a></p>
				<a href="#metricsmarkactionrequestaction" id="metricsmarkactionrequestaction" style="color: inherit; text-decoration: none;">
					<h3>metrics.markActionRequest(action)</h3>
				</a>
				<p><strong>Kind</strong>: static method of <a href="#module_metrics"><code>metrics</code></a><br><strong>Summary</strong>: Mark that an action request was received  </p>
				<table>
					<thead>
						<tr>
							<th>Param</th>
							<th>Type</th>
							<th>Description</th>
						</tr>
					</thead>
					<tbody><tr>
							<td>action</td>
							<td><code>String</code></td>
							<td>action name</td>
						</tr>
				</tbody></table>
				<p><strong>Example</strong>  </p>
				<pre><code class="language-js"><span style="color: #001080">metrics</span><span style="color: #000000">.</span><span style="color: #795E26">markActionRequest</span><span style="color: #000000">(</span><span style="color: #A31515">&#039;action-create-card&#039;</span><span style="color: #000000">)</span>
</code></pre>
				<p><a name="module_metrics.markQueueConcurrency"></a></p>
				<a href="#metricsmarkqueueconcurrency" id="metricsmarkqueueconcurrency" style="color: inherit; text-decoration: none;">
					<h3>metrics.markQueueConcurrency()</h3>
				</a>
				<p><strong>Kind</strong>: static method of <a href="#module_metrics"><code>metrics</code></a><br><strong>Summary</strong>: Expose current queue concurrency setting<br><strong>Example</strong>  </p>
				<pre><code class="language-js"><span style="color: #001080">metrics</span><span style="color: #000000">.</span><span style="color: #795E26">markQueueConcurrency</span><span style="color: #000000">()</span>
</code></pre>
				<p><a name="module_metrics.markJobAdd"></a></p>
				<a href="#metricsmarkjobaddaction-id" id="metricsmarkjobaddaction-id" style="color: inherit; text-decoration: none;">
					<h3>metrics.markJobAdd(action, id)</h3>
				</a>
				<p><strong>Kind</strong>: static method of <a href="#module_metrics"><code>metrics</code></a><br><strong>Summary</strong>: Mark that a new job was added to the queue  </p>
				<table>
					<thead>
						<tr>
							<th>Param</th>
							<th>Type</th>
							<th>Description</th>
						</tr>
					</thead>
					<tbody><tr>
							<td>action</td>
							<td><code>String</code></td>
							<td>action name</td>
						</tr>
						<tr>
							<td>id</td>
							<td><code>String</code></td>
							<td>id of the worker</td>
						</tr>
				</tbody></table>
				<p><strong>Example</strong>  </p>
				<pre><code class="language-js"><span style="color: #001080">metrics</span><span style="color: #000000">.</span><span style="color: #795E26">markJobAdd</span><span style="color: #000000">(</span><span style="color: #A31515">&#039;action-create-card&#039;</span><span style="color: #000000">, </span><span style="color: #001080">context</span><span style="color: #000000">.</span><span style="color: #001080">id</span><span style="color: #000000">)</span>
</code></pre>
				<p><a name="module_metrics.markJobDone"></a></p>
				<a href="#metricsmarkjobdoneaction-id-timestamp" id="metricsmarkjobdoneaction-id-timestamp" style="color: inherit; text-decoration: none;">
					<h3>metrics.markJobDone(action, id, timestamp)</h3>
				</a>
				<p><strong>Kind</strong>: static method of <a href="#module_metrics"><code>metrics</code></a><br><strong>Summary</strong>: Mark that a job in the queue has completed  </p>
				<table>
					<thead>
						<tr>
							<th>Param</th>
							<th>Type</th>
							<th>Description</th>
						</tr>
					</thead>
					<tbody><tr>
							<td>action</td>
							<td><code>String</code></td>
							<td>action name</td>
						</tr>
						<tr>
							<td>id</td>
							<td><code>String</code></td>
							<td>id of the worker</td>
						</tr>
						<tr>
							<td>timestamp</td>
							<td><code>String</code></td>
							<td>when action was completed</td>
						</tr>
				</tbody></table>
				<p><strong>Example</strong>  </p>
				<pre><code class="language-js"><span style="color: #0000FF">const</span><span style="color: #000000"> </span><span style="color: #0070C1">action</span><span style="color: #000000"> = </span><span style="color: #A31515">&#039;action-create-card&#039;</span>
<span style="color: #0000FF">const</span><span style="color: #000000"> </span><span style="color: #0070C1">timestamp</span><span style="color: #000000"> = </span><span style="color: #A31515">&#039;2020-06-08T09:33:27.481Z&#039;</span>
<span style="color: #001080">metrics</span><span style="color: #000000">.</span><span style="color: #795E26">markJobDone</span><span style="color: #000000">(</span><span style="color: #001080">action</span><span style="color: #000000">, </span><span style="color: #001080">context</span><span style="color: #000000">.</span><span style="color: #001080">id</span><span style="color: #000000">, </span><span style="color: #001080">timestamp</span><span style="color: #000000">)</span>
</code></pre>
				<p><a name="module_metrics.measureMirror"></a></p>
				<a href="#metricsmeasuremirrorintegration-fn-⇒-any" id="metricsmeasuremirrorintegration-fn-⇒-any" style="color: inherit; text-decoration: none;">
					<h3>metrics.measureMirror(integration, fn) ⇒ <code>Any</code></h3>
				</a>
				<p><strong>Kind</strong>: static method of <a href="#module_metrics"><code>metrics</code></a><br><strong>Summary</strong>: Execute a mirror, marking duration and totals<br><strong>Returns</strong>: <code>Any</code> - mirror result  </p>
				<table>
					<thead>
						<tr>
							<th>Param</th>
							<th>Type</th>
							<th>Description</th>
						</tr>
					</thead>
					<tbody><tr>
							<td>integration</td>
							<td><code>Object</code></td>
							<td>name of external integration</td>
						</tr>
						<tr>
							<td>fn</td>
							<td><code>Promise</code></td>
							<td>mirror function to execute</td>
						</tr>
				</tbody></table>
				<p><strong>Example</strong>  </p>
				<pre><code class="language-js"><span style="color: #0000FF">const</span><span style="color: #000000"> </span><span style="color: #0070C1">result</span><span style="color: #000000"> = </span><span style="color: #AF00DB">await</span><span style="color: #000000"> </span><span style="color: #001080">metrics</span><span style="color: #000000">.</span><span style="color: #795E26">measureMirror</span><span style="color: #000000">(</span><span style="color: #A31515">&#039;github&#039;</span><span style="color: #000000">, </span><span style="color: #795E26">mirror</span><span style="color: #000000">())</span>
</code></pre>
				<p><a name="module_metrics.measureTranslate"></a></p>
				<a href="#metricsmeasuretranslateintegration-fn-⇒-any" id="metricsmeasuretranslateintegration-fn-⇒-any" style="color: inherit; text-decoration: none;">
					<h3>metrics.measureTranslate(integration, fn) ⇒ <code>Any</code></h3>
				</a>
				<p><strong>Kind</strong>: static method of <a href="#module_metrics"><code>metrics</code></a><br><strong>Summary</strong>: Execute a translate, marking duration and totals<br><strong>Returns</strong>: <code>Any</code> - translate result  </p>
				<table>
					<thead>
						<tr>
							<th>Param</th>
							<th>Type</th>
							<th>Description</th>
						</tr>
					</thead>
					<tbody><tr>
							<td>integration</td>
							<td><code>Object</code></td>
							<td>name of external integration</td>
						</tr>
						<tr>
							<td>fn</td>
							<td><code>Promise</code></td>
							<td>mirror function to execute</td>
						</tr>
				</tbody></table>
				<p><strong>Example</strong>  </p>
				<pre><code class="language-js"><span style="color: #0000FF">const</span><span style="color: #000000"> </span><span style="color: #0070C1">result</span><span style="color: #000000"> = </span><span style="color: #AF00DB">await</span><span style="color: #000000"> </span><span style="color: #001080">metrics</span><span style="color: #000000">.</span><span style="color: #795E26">measureTranslate</span><span style="color: #000000">(</span><span style="color: #A31515">&#039;github&#039;</span><span style="color: #000000">, </span><span style="color: #795E26">translate</span><span style="color: #000000">())</span>
</code></pre>
				<p><a name="module_metrics.measureHttpQuery"></a></p>
				<a href="#metricsmeasurehttpqueryfn-⇒-any" id="metricsmeasurehttpqueryfn-⇒-any" style="color: inherit; text-decoration: none;">
					<h3>metrics.measureHttpQuery(fn) ⇒ <code>Any</code></h3>
				</a>
				<p><strong>Kind</strong>: static method of <a href="#module_metrics"><code>metrics</code></a><br><strong>Summary</strong>: Measure the duration of a request to the /query api endpoint<br><strong>Returns</strong>: <code>Any</code> - api result  </p>
				<table>
					<thead>
						<tr>
							<th>Param</th>
							<th>Type</th>
							<th>Description</th>
						</tr>
					</thead>
					<tbody><tr>
							<td>fn</td>
							<td><code>Promise</code></td>
							<td>api function to execute</td>
						</tr>
				</tbody></table>
				<p><a name="module_metrics.measureHttpType"></a></p>
				<a href="#metricsmeasurehttptypefn-⇒-any" id="metricsmeasurehttptypefn-⇒-any" style="color: inherit; text-decoration: none;">
					<h3>metrics.measureHttpType(fn) ⇒ <code>Any</code></h3>
				</a>
				<p><strong>Kind</strong>: static method of <a href="#module_metrics"><code>metrics</code></a><br><strong>Summary</strong>: Measure the duration of a request to the /type api endpoint<br><strong>Returns</strong>: <code>Any</code> - api result  </p>
				<table>
					<thead>
						<tr>
							<th>Param</th>
							<th>Type</th>
							<th>Description</th>
						</tr>
					</thead>
					<tbody><tr>
							<td>fn</td>
							<td><code>Promise</code></td>
							<td>api function to execute</td>
						</tr>
				</tbody></table>
				<p><a name="module_metrics.measureHttpId"></a></p>
				<a href="#metricsmeasurehttpidfn-⇒-any" id="metricsmeasurehttpidfn-⇒-any" style="color: inherit; text-decoration: none;">
					<h3>metrics.measureHttpId(fn) ⇒ <code>Any</code></h3>
				</a>
				<p><strong>Kind</strong>: static method of <a href="#module_metrics"><code>metrics</code></a><br><strong>Summary</strong>: Measure the duration of a request to the /id api endpoint<br><strong>Returns</strong>: <code>Any</code> - api result  </p>
				<table>
					<thead>
						<tr>
							<th>Param</th>
							<th>Type</th>
							<th>Description</th>
						</tr>
					</thead>
					<tbody><tr>
							<td>fn</td>
							<td><code>Promise</code></td>
							<td>api function to execute</td>
						</tr>
				</tbody></table>
				<p><a name="module_metrics.measureHttpSlug"></a></p>
				<a href="#metricsmeasurehttpslugfn-⇒-any" id="metricsmeasurehttpslugfn-⇒-any" style="color: inherit; text-decoration: none;">
					<h3>metrics.measureHttpSlug(fn) ⇒ <code>Any</code></h3>
				</a>
				<p><strong>Kind</strong>: static method of <a href="#module_metrics"><code>metrics</code></a><br><strong>Summary</strong>: Measure the duration of a request to the /slug api endpoint<br><strong>Returns</strong>: <code>Any</code> - api result  </p>
				<table>
					<thead>
						<tr>
							<th>Param</th>
							<th>Type</th>
							<th>Description</th>
						</tr>
					</thead>
					<tbody><tr>
							<td>fn</td>
							<td><code>Promise</code></td>
							<td>api function to execute</td>
						</tr>
				</tbody></table>
				<p><a name="module_metrics.measureHttpAction"></a></p>
				<a href="#metricsmeasurehttpactionfn-⇒-any" id="metricsmeasurehttpactionfn-⇒-any" style="color: inherit; text-decoration: none;">
					<h3>metrics.measureHttpAction(fn) ⇒ <code>Any</code></h3>
				</a>
				<p><strong>Kind</strong>: static method of <a href="#module_metrics"><code>metrics</code></a><br><strong>Summary</strong>: Measure the duration of a request to the /action api endpoint<br><strong>Returns</strong>: <code>Any</code> - api result  </p>
				<table>
					<thead>
						<tr>
							<th>Param</th>
							<th>Type</th>
							<th>Description</th>
						</tr>
					</thead>
					<tbody><tr>
							<td>fn</td>
							<td><code>Promise</code></td>
							<td>api function to execute</td>
						</tr>
				</tbody></table>
				<p><a name="module_metrics.measureHttpWhoami"></a></p>
				<a href="#metricsmeasurehttpwhoamifn-⇒-any" id="metricsmeasurehttpwhoamifn-⇒-any" style="color: inherit; text-decoration: none;">
					<h3>metrics.measureHttpWhoami(fn) ⇒ <code>Any</code></h3>
				</a>
				<p><strong>Kind</strong>: static method of <a href="#module_metrics"><code>metrics</code></a><br><strong>Summary</strong>: Measure the duration of a request to the /action api endpoint<br><strong>Returns</strong>: <code>Any</code> - api result  </p>
				<table>
					<thead>
						<tr>
							<th>Param</th>
							<th>Type</th>
							<th>Description</th>
						</tr>
					</thead>
					<tbody><tr>
							<td>fn</td>
							<td><code>Promise</code></td>
							<td>api function to execute</td>
						</tr>
				</tbody></table>
				<p><a name="module_metrics.markSqlGenTime"></a></p>
				<a href="#metricsmarksqlgentimems" id="metricsmarksqlgentimems" style="color: inherit; text-decoration: none;">
					<h3>metrics.markSqlGenTime(ms)</h3>
				</a>
				<p><strong>Kind</strong>: static method of <a href="#module_metrics"><code>metrics</code></a><br><strong>Summary</strong>: Mark how long it took to generate an SQL query from a JSON schema  </p>
				<table>
					<thead>
						<tr>
							<th>Param</th>
							<th>Type</th>
							<th>Description</th>
						</tr>
					</thead>
					<tbody><tr>
							<td>ms</td>
							<td><code>Number</code></td>
							<td>number of milliseconds it took to generate the query</td>
						</tr>
				</tbody></table>
				<p><a name="module_metrics.markQueryTime"></a></p>
				<a href="#metricsmarkquerytimems" id="metricsmarkquerytimems" style="color: inherit; text-decoration: none;">
					<h3>metrics.markQueryTime(ms)</h3>
				</a>
				<p><strong>Kind</strong>: static method of <a href="#module_metrics"><code>metrics</code></a><br><strong>Summary</strong>: Mark how long it took to execute an SQL query  </p>
				<table>
					<thead>
						<tr>
							<th>Param</th>
							<th>Type</th>
							<th>Description</th>
						</tr>
					</thead>
					<tbody><tr>
							<td>ms</td>
							<td><code>Number</code></td>
							<td>number of milliseconds it took to execute the query</td>
						</tr>
				</tbody></table>
				<p><a name="module_metrics.markStreamOpened"></a></p>
				<a href="#metricsmarkstreamopenedcontext-table" id="metricsmarkstreamopenedcontext-table" style="color: inherit; text-decoration: none;">
					<h3>metrics.markStreamOpened(context, table)</h3>
				</a>
				<p><strong>Kind</strong>: static method of <a href="#module_metrics"><code>metrics</code></a><br><strong>Summary</strong>: Mark that a new stream was opened  </p>
				<table>
					<thead>
						<tr>
							<th>Param</th>
							<th>Type</th>
							<th>Description</th>
						</tr>
					</thead>
					<tbody><tr>
							<td>context</td>
							<td><code>Object</code></td>
							<td>caller context</td>
						</tr>
						<tr>
							<td>table</td>
							<td><code>String</code></td>
							<td>table name</td>
						</tr>
				</tbody></table>
				<p><strong>Example</strong>  </p>
				<pre><code class="language-js"><span style="color: #001080">metrics</span><span style="color: #000000">.</span><span style="color: #795E26">markStreamOpened</span><span style="color: #000000">(</span><span style="color: #001080">context</span><span style="color: #000000">, </span><span style="color: #A31515">&#039;cards&#039;</span><span style="color: #000000">)</span>
</code></pre>
				<p><a name="module_metrics.markStreamClosed"></a></p>
				<a href="#metricsmarkstreamclosedcontext-table" id="metricsmarkstreamclosedcontext-table" style="color: inherit; text-decoration: none;">
					<h3>metrics.markStreamClosed(context, table)</h3>
				</a>
				<p><strong>Kind</strong>: static method of <a href="#module_metrics"><code>metrics</code></a><br><strong>Summary</strong>: Mark that a stream was closed  </p>
				<table>
					<thead>
						<tr>
							<th>Param</th>
							<th>Type</th>
							<th>Description</th>
						</tr>
					</thead>
					<tbody><tr>
							<td>context</td>
							<td><code>Object</code></td>
							<td>caller context</td>
						</tr>
						<tr>
							<td>table</td>
							<td><code>String</code></td>
							<td>table name</td>
						</tr>
				</tbody></table>
				<p><strong>Example</strong>  </p>
				<pre><code class="language-js"><span style="color: #001080">metrics</span><span style="color: #000000">.</span><span style="color: #795E26">markStreamClosed</span><span style="color: #000000">(</span><span style="color: #001080">context</span><span style="color: #000000">, </span><span style="color: #A31515">&#039;cards&#039;</span><span style="color: #000000">)</span>
</code></pre>
				<p><a name="module_metrics.markStreamLinkQuery"></a></p>
				<a href="#metricsmarkstreamlinkquerycontext-table-change" id="metricsmarkstreamlinkquerycontext-table-change" style="color: inherit; text-decoration: none;">
					<h3>metrics.markStreamLinkQuery(context, table, change)</h3>
				</a>
				<p><strong>Kind</strong>: static method of <a href="#module_metrics"><code>metrics</code></a><br><strong>Summary</strong>: Mark that a stream is querying links  </p>
				<table>
					<thead>
						<tr>
							<th>Param</th>
							<th>Type</th>
							<th>Description</th>
						</tr>
					</thead>
					<tbody><tr>
							<td>context</td>
							<td><code>Object</code></td>
							<td>caller context</td>
						</tr>
						<tr>
							<td>table</td>
							<td><code>String</code></td>
							<td>table name</td>
						</tr>
						<tr>
							<td>change</td>
							<td><code>Object</code></td>
							<td>change event object</td>
						</tr>
				</tbody></table>
				<p><strong>Example</strong>  </p>
				<pre><code class="language-js"><span style="color: #001080">metrics</span><span style="color: #000000">.</span><span style="color: #795E26">markStreamLinkQuery</span><span style="color: #000000">(</span><span style="color: #001080">context</span><span style="color: #000000">, </span><span style="color: #A31515">&#039;cards&#039;</span><span style="color: #000000">, </span><span style="color: #001080">change</span><span style="color: #000000">)</span>
</code></pre>
				<p><a name="module_metrics.markStreamError"></a></p>
				<a href="#metricsmarkstreamerrorcontext-table" id="metricsmarkstreamerrorcontext-table" style="color: inherit; text-decoration: none;">
					<h3>metrics.markStreamError(context, table)</h3>
				</a>
				<p><strong>Kind</strong>: static method of <a href="#module_metrics"><code>metrics</code></a><br><strong>Summary</strong>: Mark that a stream error has occurred  </p>
				<table>
					<thead>
						<tr>
							<th>Param</th>
							<th>Type</th>
							<th>Description</th>
						</tr>
					</thead>
					<tbody><tr>
							<td>context</td>
							<td><code>Object</code></td>
							<td>caller context</td>
						</tr>
						<tr>
							<td>table</td>
							<td><code>String</code></td>
							<td>table name</td>
						</tr>
				</tbody></table>
				<p><strong>Example</strong>  </p>
				<pre><code class="language-js"><span style="color: #001080">metrics</span><span style="color: #000000">.</span><span style="color: #795E26">markStreamError</span><span style="color: #000000">()</span>
</code></pre>
				<p><a name="module_metrics.measureCardPatch"></a></p>
				<a href="#metricsmeasurecardpatchfn-⇒-any" id="metricsmeasurecardpatchfn-⇒-any" style="color: inherit; text-decoration: none;">
					<h3>metrics.measureCardPatch(fn) ⇒ <code>Any</code></h3>
				</a>
				<p><strong>Kind</strong>: static method of <a href="#module_metrics"><code>metrics</code></a><br><strong>Summary</strong>: Execute a card patch, marking duration and totals<br><strong>Returns</strong>: <code>Any</code> - card patch result  </p>
				<table>
					<thead>
						<tr>
							<th>Param</th>
							<th>Type</th>
							<th>Description</th>
						</tr>
					</thead>
					<tbody><tr>
							<td>fn</td>
							<td><code>Promise</code></td>
							<td>card patch function to execute</td>
						</tr>
				</tbody></table>
				<p><strong>Example</strong>  </p>
				<pre><code class="language-js"><span style="color: #0000FF">const</span><span style="color: #000000"> </span><span style="color: #0070C1">result</span><span style="color: #000000"> = </span><span style="color: #AF00DB">await</span><span style="color: #000000"> </span><span style="color: #001080">metrics</span><span style="color: #000000">.</span><span style="color: #795E26">measureCardPatch</span><span style="color: #000000">(</span><span style="color: #001080">fn</span><span style="color: #000000">)</span>
</code></pre>
				<p><a name="module_metrics..measureAsync"></a></p>
				<a href="#metricsmeasureasyncname-labels-fn-⇒-any" id="metricsmeasureasyncname-labels-fn-⇒-any" style="color: inherit; text-decoration: none;">
					<h3>metrics~measureAsync(name, labels, fn) ⇒ <code>Any</code></h3>
				</a>
				<p><strong>Kind</strong>: inner method of <a href="#module_metrics"><code>metrics</code></a><br><strong>Summary</strong>: Measure duration of a promise execution and add to metrics<br><strong>Returns</strong>: <code>Any</code> - promise execution result  </p>
				<table>
					<thead>
						<tr>
							<th>Param</th>
							<th>Type</th>
							<th>Description</th>
						</tr>
					</thead>
					<tbody><tr>
							<td>name</td>
							<td><code>String</code></td>
							<td>metric name</td>
						</tr>
						<tr>
							<td>labels</td>
							<td><code>Object</code> | <code>function</code></td>
							<td>metric labels object or callback that returns labels object</td>
						</tr>
						<tr>
							<td>fn</td>
							<td><code>Promise</code></td>
							<td>function to execute and measure</td>
						</tr>
				</tbody></table>
				<p><strong>Example</strong>  </p>
				<pre><code class="language-js"><span style="color: #0000FF">const</span><span style="color: #000000"> </span><span style="color: #0070C1">result</span><span style="color: #000000"> = </span><span style="color: #AF00DB">await</span><span style="color: #000000"> </span><span style="color: #795E26">measureAsync</span><span style="color: #000000">(</span><span style="color: #A31515">&#039;my_metric&#039;</span><span style="color: #000000">, { ... }, </span><span style="color: #001080">myFunction</span><span style="color: #000000">, ...</span><span style="color: #001080">params</span><span style="color: #000000">)</span>
</code></pre>
				<p><a name="module_metrics..isCard"></a></p>
				<a href="#metricsiscardcard-⇒-boolean" id="metricsiscardcard-⇒-boolean" style="color: inherit; text-decoration: none;">
					<h3>metrics~isCard(card) ⇒ <code>Boolean</code></h3>
				</a>
				<p><strong>Kind</strong>: inner method of <a href="#module_metrics"><code>metrics</code></a><br><strong>Summary</strong>: Checks if an object looks to be a valid card or not.<br><strong>Returns</strong>: <code>Boolean</code> - validation result, true if card, false if not  </p>
				<table>
					<thead>
						<tr>
							<th>Param</th>
							<th>Type</th>
							<th>Description</th>
						</tr>
					</thead>
					<tbody><tr>
							<td>card</td>
							<td><code>Object</code></td>
							<td>object to validate</td>
						</tr>
				</tbody></table>
				<p><strong>Example</strong>  </p>
				<pre><code class="language-js"><span style="color: #0000FF">const</span><span style="color: #000000"> </span><span style="color: #0070C1">result</span><span style="color: #000000"> = </span><span style="color: #795E26">isCard</span><span style="color: #000000">(</span><span style="color: #001080">card</span><span style="color: #000000">)</span>
</code></pre>
				<p><a name="module_metrics..getAsyncMeasureFn"></a></p>
				<a href="#metricsgetasyncmeasurefnprefix-labels-⇒-any" id="metricsgetasyncmeasurefnprefix-labels-⇒-any" style="color: inherit; text-decoration: none;">
					<h3>metrics~getAsyncMeasureFn(prefix, labels) ⇒ <code>Any</code></h3>
				</a>
				<p><strong>Kind</strong>: inner method of <a href="#module_metrics"><code>metrics</code></a><br><strong>Summary</strong>: Generates a generic measurement wrapper for an async function, that
				tracks total calls, total failures and duration<br><strong>Returns</strong>: <code>Any</code> - api result  </p>
				<table>
					<thead>
						<tr>
							<th>Param</th>
							<th>Type</th>
							<th>Description</th>
						</tr>
					</thead>
					<tbody><tr>
							<td>prefix</td>
							<td><code>String</code></td>
							<td>metric name prefix</td>
						</tr>
						<tr>
							<td>labels</td>
							<td><code>Object</code> | <code>function</code></td>
							<td>metric labels object or callback that returns labels object</td>
						</tr>
				</tbody></table>
			</div>
		</div>
		<div class="col-4 col-menu menu-sticky-wrap menu-highlight">
			<nav class="tsd-navigation primary">
				<ul>
					<li class=" ">
						<a href="modules.html">Exports</a>
					</li>
					<li class=" tsd-kind-module">
						<a href="modules/descriptions.html">descriptions</a>
					</li>
					<li class=" tsd-kind-module">
						<a href="modules/index.html">index</a>
					</li>
					<li class=" tsd-kind-module">
						<a href="modules/types.html">types</a>
					</li>
					<li class=" tsd-kind-module">
						<a href="modules/utils.html">utils</a>
					</li>
				</ul>
			</nav>
			<nav class="tsd-navigation secondary menu-sticky">
				<ul class="before-current">
				</ul>
			</nav>
		</div>
	</div>
</div>
<footer class="with-border-bottom">
	<div class="container">
		<h2>Legend</h2>
		<div class="tsd-legend-group">
			<ul class="tsd-legend">
				<li class="tsd-kind-variable"><span class="tsd-kind-icon">Variable</span></li>
				<li class="tsd-kind-function"><span class="tsd-kind-icon">Function</span></li>
			</ul>
			<ul class="tsd-legend">
				<li class="tsd-kind-interface"><span class="tsd-kind-icon">Interface</span></li>
			</ul>
		</div>
	</div>
</footer>
<div class="container tsd-generator">
	<p>Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p>
</div>
<div class="overlay"></div>
<script src="assets/js/main.js"></script>
</body>
</html>